(function(){"use strict";var e={2701:function(e,t,a){var i=a(5130),o=a(6768),n=a(4232);const l={key:0,class:"d-flex align-center overflow-hidden flex-grow-1"},s={class:"coord-label mr-3"},r={class:"d-flex space-group"},c={class:"space-tag"},d={class:"text-caption"},h={key:1},u={key:2,class:"d-flex align-center overflow-hidden flex-grow-1 justify-end"},p={class:"d-flex space-group"},g={class:"space-tag"},m={class:"text-caption"},v={class:"coord-label ml-3"};function f(e,t,a,i,f,y){const b=(0,o.g2)("MenuComponent"),w=(0,o.g2)("ResizeComponent"),k=(0,o.g2)("CanvasComponent"),x=(0,o.g2)("LayersComponent"),C=(0,o.g2)("v-footer"),L=(0,o.g2)("v-tooltip"),F=(0,o.g2)("v-chip"),_=(0,o.g2)("v-app");return(0,o.uX)(),(0,o.Wv)(_,null,{default:(0,o.k6)(()=>[(0,o.bF)(b,{"scale-percent":f.scalePercent,"active-tool":f.activeTool,"can-add-layer":f.layers.length<2,onImageLoaded:y.onLayerAdded,onScaleChanged:y.onScaleChanged,onOpenResize:t[0]||(t[0]=e=>f.showResize=!0),onToolChanged:t[1]||(t[1]=e=>f.activeTool=e),onAddColorLayer:y.onColorLayerAdded},null,8,["scale-percent","active-tool","can-add-layer","onImageLoaded","onScaleChanged","onAddColorLayer"]),(0,o.bF)(w,{modelValue:f.showResize,"onUpdate:modelValue":t[2]||(t[2]=e=>f.showResize=e),width:f.layers[0]?.width||0,height:f.layers[0]?.height||0,onConfirm:y.applyResize},null,8,["modelValue","width","height","onConfirm"]),(0,o.bF)(k,{ref:"canvas",layers:f.layers,"image-src":f.imageSrc,"scale-percent":f.scalePercent,"active-tool":f.activeTool,onPickColor:y.onPickColor},null,8,["layers","image-src","scale-percent","active-tool","onPickColor"]),(0,o.bF)(x,{layers:f.layers,"active-index":f.activeLayerIndex,onUpdateActive:t[3]||(t[3]=e=>f.activeLayerIndex=e),onToggleVisibility:y.toggleVisibility,onToggleAlpha:y.toggleAlpha,onRemoveLayer:y.removeLayer,onRemoveAlpha:y.removeAlpha,onUpdateOpacity:y.updateOpacity,onUpdateBlend:y.updateBlend},null,8,["layers","active-index","onToggleVisibility","onToggleAlpha","onRemoveLayer","onRemoveAlpha","onUpdateOpacity","onUpdateBlend"]),(0,o.bF)(C,{app:"",height:"32",color:"grey-darken-4",class:"white--text px-4 align-center justify-center"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(y.statusText),1)]),_:1}),"eyedropper"===f.activeTool?((0,o.uX)(),(0,o.Wv)(C,{key:0,app:"",height:"32",color:"grey-darken-4",class:"white--text px-2 d-flex align-center justify-space-between eyedropper-footer"},{default:(0,o.k6)(()=>[f.colorA?((0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",{class:"swatch-box",style:(0,n.Tr)({background:y.rgbString(f.colorA)}),title:"Цвет A"},null,4),(0,o.Lk)("span",s,[t[4]||(t[4]=(0,o.Lk)("strong",null,"Цвет 1",-1)),(0,o.eW)(" ("+(0,n.v_)(f.colorA.x)+", "+(0,n.v_)(f.colorA.y)+") ",1)]),(0,o.Lk)("div",r,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(["RGB","XYZ","Lab","OKLch"],e=>(0,o.bF)(L,{key:e,location:"top",offset:"10"},{activator:(0,o.k6)(({props:t})=>[(0,o.Lk)("span",(0,o.v6)({ref_for:!0},t,{class:"space-val"}),[(0,o.Lk)("span",c,(0,n.v_)(e),1),(0,o.eW)(" "+(0,n.v_)(y.getSpaceValues(e,f.colorA)),1)],16)]),default:(0,o.k6)(()=>[(0,o.Lk)("div",d,[(0,o.Lk)("strong",null,(0,n.v_)(f.spaceInfo[e].title),1),t[5]||(t[5]=(0,o.Lk)("br",null,null,-1)),(0,o.eW)(" "+(0,n.v_)(f.spaceInfo[e].axes),1)])]),_:2},1024)),64))])])):(0,o.Q3)("",!0),f.colorA&&f.colorB?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.bF)(F,{size:"small",color:"#008FFF"},{default:(0,o.k6)(()=>[(0,o.eW)(" Контраст: "+(0,n.v_)(y.contrastValue)+":1 ",1)]),_:1})])):(0,o.Q3)("",!0),f.colorB?((0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("div",p,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(["RGB","XYZ","Lab","OKLch"],e=>(0,o.bF)(L,{key:e,location:"top",offset:"10"},{activator:(0,o.k6)(({props:t})=>[(0,o.Lk)("span",(0,o.v6)({ref_for:!0},t,{class:"space-val"}),[(0,o.Lk)("span",g,(0,n.v_)(e),1),(0,o.eW)(" "+(0,n.v_)(y.getSpaceValues(e,f.colorB)),1)],16)]),default:(0,o.k6)(()=>[(0,o.Lk)("div",m,[(0,o.Lk)("strong",null,(0,n.v_)(f.spaceInfo[e].title),1),t[6]||(t[6]=(0,o.Lk)("br",null,null,-1)),(0,o.eW)(" "+(0,n.v_)(f.spaceInfo[e].axes),1)])]),_:2},1024)),64))]),(0,o.Lk)("span",v,[(0,o.eW)(" ("+(0,n.v_)(f.colorB.x)+", "+(0,n.v_)(f.colorB.y)+") ",1),t[7]||(t[7]=(0,o.Lk)("strong",null,"Цвет 2",-1))]),(0,o.Lk)("div",{class:"swatch-box ml-2",style:(0,n.Tr)({background:y.rgbString(f.colorB)}),title:"Цвет B"},null,4)])):(0,o.Q3)("",!0)]),_:1})):(0,o.Q3)("",!0)]),_:1})}a(4114),a(6573),a(8100),a(7936),a(8111),a(1701),a(9577);function y(e,t,a,i,l,s){const r=(0,o.g2)("v-toolbar-title"),c=(0,o.g2)("v-btn"),d=(0,o.g2)("v-color-picker"),h=(0,o.g2)("v-menu"),u=(0,o.g2)("v-img"),p=(0,o.g2)("v-tooltip"),g=(0,o.g2)("v-select"),m=(0,o.g2)("v-app-bar");return(0,o.uX)(),(0,o.Wv)(m,{app:"",color:"primary"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[...t[4]||(t[4]=[(0,o.eW)("Онлайн Фотошоп",-1)])]),_:1}),(0,o.bF)(c,{disabled:!a.canAddLayer,onClick:s.triggerFileInput,class:"mr-4"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(0===a.layersCount?"Загрузить фото":"Добавить слой"),1)]),_:1},8,["disabled","onClick"]),a.layersCount>0&&a.canAddLayer?((0,o.uX)(),(0,o.Wv)(h,{key:0},{activator:(0,o.k6)(({props:e})=>[(0,o.bF)(c,(0,o.v6)(e,{class:"ml-2"}),{default:(0,o.k6)(()=>[...t[5]||(t[5]=[(0,o.eW)("Заливка цветом",-1)])]),_:1},16)]),default:(0,o.k6)(()=>[(0,o.bF)(d,{"onUpdate:modelValue":s.onColorSelect},null,8,["onUpdate:modelValue"])]),_:1})):(0,o.Q3)("",!0),(0,o.bF)(p,{text:"Рука (H)",location:"bottom"},{activator:(0,o.k6)(({props:i})=>[(0,o.bF)(c,(0,o.v6)(i,{icon:"",color:"hand"===a.activeTool?"white":"white-darken-2",variant:"hand"===a.activeTool?"tonal":"text",onClick:t[0]||(t[0]=t=>e.$emit("tool-changed","hand"))}),{default:(0,o.k6)(()=>[(0,o.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/658/658022.png",width:"28px"})]),_:1},16,["color","variant"])]),_:1}),(0,o.bF)(p,{text:"Пипетка (I)",location:"bottom"},{activator:(0,o.k6)(({props:i})=>[(0,o.bF)(c,(0,o.v6)(i,{icon:"",color:"eyedropper"===a.activeTool?"white":"white-darken-2",variant:"eyedropper"===a.activeTool?"tonal":"text",onClick:t[1]||(t[1]=t=>e.$emit("tool-changed","eyedropper"))}),{default:(0,o.k6)(()=>[(0,o.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/4347/4347420.png",width:"28px"})]),_:1},16,["color","variant"])]),_:1}),(0,o.bF)(c,{onClick:s.triggerFileInput,class:"mr-4"},{default:(0,o.k6)(()=>[...t[6]||(t[6]=[(0,o.eW)(" Загрузить изображение ",-1)])]),_:1},8,["onClick"]),(0,o.bF)(c,{class:"ml-2",onClick:t[2]||(t[2]=t=>e.$emit("open-resize"))},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)(" Изменить размер ",-1)])]),_:1}),(0,o.bF)(g,{items:l.scales,"model-value":l.currentScale,label:"Масштаб",density:"compact",style:{"max-width":"120px"},"onUpdate:modelValue":s.onScaleChange},null,8,["items","model-value","onUpdate:modelValue"]),(0,o.Lk)("input",{ref:"fileInput",type:"file",accept:".jpg,.jpeg,.png,.gb7",hidden:"",onChange:t[3]||(t[3]=(...e)=>s.onFileChange&&s.onFileChange(...e))},null,544)]),_:1})}var b={name:"MenuComponent",emits:["tool-changed"],props:["scalePercent","activeTool","canAddLayer","layersCount"],data(){return{scales:[12,25,50,75,100,150,200,300],currentScale:100}},mounted(){window.addEventListener("keydown",e=>{"h"===e.key.toLowerCase()&&this.setTool("hand"),"i"===e.key.toLowerCase()&&this.setTool("eyedropper")})},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},watch:{scalePercent(e){this.currentScale=e}},methods:{onColorSelect(e){this.$emit("add-color-layer",e.rgba)},setTool(e){this.$emit("tool-changed",e)},onKeyDown(e){const t=e.key.toLowerCase();"h"===t&&this.setTool("hand"),"i"===t&&this.setTool("eyedropper")},triggerFileInput(){this.$refs.fileInput.click()},onScaleChange(e){this.currentScale=e,this.$emit("scale-changed",Number(e))},async onFileChange(e){const t=e.target.files[0];if(!t)return;const a=t.name.split(".").pop().toLowerCase();if(["jpg","jpeg","png"].includes(a)){const e=new FileReader;e.onload=e=>{const t=new Image;t.onload=()=>{this.$emit("image-loaded",{type:"image",src:e.target.result,width:t.width,height:t.height,depth:screen.colorDepth})},t.src=e.target.result},e.readAsDataURL(t)}else if("gb7"===a){const e=await t.arrayBuffer(),a=new DataView(e);if(71!==a.getUint8(0)||66!==a.getUint8(1)||55!==a.getUint8(2)||29!==a.getUint8(3))return void alert("Неверный формат GB7");const i=a.getUint8(5),o=a.getUint16(6,!1),n=a.getUint16(8,!1),l=new Uint8ClampedArray(o*n*4);let s=12;for(let t=0;t<o*n;t++){const e=a.getUint8(s++),o=127&e,n=(128&e)>>7,r=2*o;l[4*t]=r,l[4*t+1]=r,l[4*t+2]=r,l[4*t+3]=i&&0===n?0:255}this.$emit("image-loaded",{type:"gb7",width:o,height:n,pixels:l,depth:7})}}}},w=a(1241);const k=(0,w.A)(b,[["render",y],["__scopeId","data-v-5eeee7f4"]]);var x=k;const C={key:0,class:"text-grey"};function L(e,t,a,l,s,r){return(0,o.uX)(),(0,o.CE)("div",{class:"canvas-container",ref:"container",onMousedown:t[1]||(t[1]=(...e)=>r.onMouseDown&&r.onMouseDown(...e)),onMousemove:t[2]||(t[2]=(...e)=>r.onMouseMove&&r.onMouseMove(...e)),onMouseup:t[3]||(t[3]=(...e)=>r.onMouseUp&&r.onMouseUp(...e)),onMouseleave:t[4]||(t[4]=(...e)=>r.onMouseUp&&r.onMouseUp(...e))},[(0,o.bo)((0,o.Lk)("canvas",{ref:"canvas",onClick:t[0]||(t[0]=(...e)=>r.onClick&&r.onClick(...e)),style:(0,n.Tr)(r.canvasStyle)},null,4),[[i.aG,a.layers.length>0]]),0===a.layers.length?((0,o.uX)(),(0,o.CE)("div",C,"Загрузите изображение для начала работы")):(0,o.Q3)("",!0)],544)}a(7588);var F={name:"CanvasComponent",props:{imageSrc:Object,scalePercent:Number,activeTool:String,layers:{type:Array,default:()=>[]}},emits:["pick-color","scale-changed"],data(){return{originalPixels:null,originalWidth:0,originalHeight:0,scale:1,ctx:null,imageData:null,colorA:null,colorB:null,offsetX:0,offsetY:0,isDragging:!1,lastMouseX:0,lastMouseY:0,viewPadding:50}},computed:{canvasStyle(){return{transform:`translate(${this.offsetX}px, ${this.offsetY}px)`,cursor:"hand"===this.activeTool?this.isDragging?"grabbing":"grab":"crosshair",transition:this.isDragging?"none":"transform 0.1s ease-out"}}},mounted(){window.addEventListener("keydown",this.onKeyDown)},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},watch:{imageSrc(e){e&&("image"===e.type?this.loadStandardImage(e.src):"gb7"===e.type&&this.loadGB7(e))},scalePercent(e){this.scale=e/100,this.redraw()},layers:{handler(e){e.length>0&&(1===e.length&&1===this.scale?this.fitToScreen():this.redraw())},deep:!0}},methods:{loadStandardImage(e){const t=new Image;t.onload=()=>{this.originalWidth=t.width,this.originalHeight=t.height;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d");a.drawImage(t,0,0),this.originalPixels=a.getImageData(0,0,t.width,t.height).data,this.fitToScreen()},t.src=e},loadGB7({width:e,height:t,pixels:a}){this.originalWidth=e,this.originalHeight=t,this.originalPixels=a,this.fitToScreen()},resetPosition(){this.offsetX=0,this.offsetY=0},constrainOffset(e,t){const a=this.$refs.container,i=this.$refs.canvas;if(!a||!i)return{x:e,y:t};const o=a.clientWidth,n=a.clientHeight,l=i.width,s=i.height,r=l/2+o/2-this.viewPadding,c=s/2+n/2-this.viewPadding;return{x:Math.max(-r,Math.min(r,e)),y:Math.max(-c,Math.min(c,t))}},onMouseDown(e){"hand"===this.activeTool&&(this.isDragging=!0,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY)},onMouseMove(e){if(!this.isDragging||"hand"!==this.activeTool)return;const t=e.clientX-this.lastMouseX,a=e.clientY-this.lastMouseY,i=this.constrainOffset(this.offsetX+t,this.offsetY+a);this.offsetX=i.x,this.offsetY=i.y,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY},onMouseUp(){this.isDragging=!1},onKeyDown(e){if("hand"!==this.activeTool)return;const t=e.shiftKey?50:10;let a=0,i=0;if("ArrowLeft"===e.key&&(a=-t),"ArrowRight"===e.key&&(a=t),"ArrowUp"===e.key&&(i=-t),"ArrowDown"===e.key&&(i=t),0!==a||0!==i){e.preventDefault();const t=this.constrainOffset(this.offsetX+a,this.offsetY+i);this.offsetX=t.x,this.offsetY=t.y}},fitToScreen(){if(!this.layers||0===this.layers.length)return;const e=this.$refs.container,t=this.layers[0],a=e.clientWidth-100,i=e.clientHeight-100,o=Math.min(a/t.width,i/t.height,1);this.scale=o,this.$emit("scale-changed",Math.round(100*o)),this.redraw()},redraw(){if(!this.layers||0===this.layers.length)return;const e=this.layers[0],t=Math.round(e.width*this.scale),a=Math.round(e.height*this.scale),i=this.$refs.canvas;if(!i)return;i.width=t,i.height=a;const o=i.getContext("2d",{willReadFrequently:!0}),n=new Uint8ClampedArray(t*a*4);this.layers.forEach((e,i)=>{if(!e.visible)return;const o=this.bilinear(e.pixels,e.width,e.height,t,a);if(0===i){const t=e.opacity/100;for(let a=0;a<n.length;a+=4){n[a]=o[a],n[a+1]=o[a+1],n[a+2]=o[a+2];const i=e.alphaVisible?o[a+3]:255;n[a+3]=i*t}}else this.blendLayers(n,o,e)}),this.imageData=new ImageData(n,t,a),o.putImageData(this.imageData,0,0)},blendLayers(e,t,a){const i=a.opacity/100;for(let o=0;o<e.length;o+=4){const n=e[o+3]/255,l=t[o],s=t[o+1],r=t[o+2],c=(a.alphaVisible?t[o+3]/255:1)*i,d=e[o],h=e[o+1],u=e[o+2];let p,g,m;const v=d/255,f=l/255,y=h/255,b=s/255,w=u/255,k=r/255;if("multiply"===a.blendMode)p=v*f,g=y*b,m=w*k;else if("screen"===a.blendMode)p=1-(1-v)*(1-f),g=1-(1-y)*(1-b),m=1-(1-w)*(1-k);else if("overlay"===a.blendMode){const e=(e,t)=>e<.5?2*e*t:1-2*(1-e)*(1-t);p=e(v,f),g=e(y,b),m=e(w,k)}else p=f,g=b,m=k;const x=c+n*(1-c);x>0&&(e[o]=(255*p*c+d*n*(1-c))/x,e[o+1]=(255*g*c+h*n*(1-c))/x,e[o+2]=(255*m*c+u*n*(1-c))/x,e[o+3]=255*x)}},runResizeAlgo(e,t,a,i,o,n){return"nearest"===n?this.nearest(e,t,a,i,o):this.bilinear(e,t,a,i,o)},bilinear(e,t,a,i,o){const n=new Uint8ClampedArray(i*o*4);for(let l=0;l<o;l++)for(let s=0;s<i;s++){const r=(s+.5)*t/i-.5,c=(l+.5)*a/o-.5,d=Math.floor(r),h=Math.floor(c),u=Math.min(d+1,t-1),p=Math.min(h+1,a-1),g=r-d,m=c-h;for(let a=0;a<4;a++){const o=4*(h*t+d)+a,r=4*(h*t+u)+a,c=4*(p*t+d)+a,v=4*(p*t+u)+a;n[4*(l*i+s)+a]=e[o]*(1-g)*(1-m)+e[r]*g*(1-m)+e[c]*(1-g)*m+e[v]*g*m}}return n},nearest(e,t,a,i,o){const n=new Uint8ClampedArray(i*o*4);for(let l=0;l<o;l++)for(let s=0;s<i;s++){const r=Math.floor(s*t/i),c=Math.floor(l*a/o),d=4*(c*t+r),h=4*(l*i+s);n[h]=e[d],n[h+1]=e[d+1],n[h+2]=e[d+2],n[h+3]=e[d+3]}return n},resizeImage(e,t,a){const i="nearest"===a?this.nearest:this.bilinear,o=i(this.originalPixels,this.originalWidth,this.originalHeight,e,t);this.originalPixels=o,this.originalWidth=e,this.originalHeight=t,this.scale=1,this.redraw()},onClick(e){if("eyedropper"!==this.activeTool)return;if(!this.imageData)return;e.preventDefault();const t=this.$refs.canvas.getBoundingClientRect(),a=Math.floor(e.clientX-t.left),i=Math.floor(e.clientY-t.top);if(a<0||i<0||a>=this.imageData.width||i>=this.imageData.height)return;const o=4*(i*this.imageData.width+a),n={r:this.imageData.data[o],g:this.imageData.data[o+1],b:this.imageData.data[o+2],x:a,y:i},l=e.altKey||e.ctrlKey||e.shiftKey,s=l?"B":"A";console.log(`Picked color for slot ${s}:`,n),this.$emit("pick-color",{color:n,slot:s})}}};const _=(0,w.A)(F,[["render",L],["__scopeId","data-v-47591abc"]]);var M=_;const V={class:"mb-3"};function A(e,t,a,i,l,s){const r=(0,o.g2)("v-card-title"),c=(0,o.g2)("v-select"),d=(0,o.g2)("v-text-field"),h=(0,o.g2)("v-checkbox"),u=(0,o.g2)("v-tooltip"),p=(0,o.g2)("v-card-text"),g=(0,o.g2)("v-spacer"),m=(0,o.g2)("v-btn"),v=(0,o.g2)("v-card-actions"),f=(0,o.g2)("v-card"),y=(0,o.g2)("v-dialog");return(0,o.uX)(),(0,o.Wv)(y,{modelValue:s.open,"onUpdate:modelValue":t[5]||(t[5]=e=>s.open=e),"max-width":"520"},{default:(0,o.k6)(()=>[(0,o.bF)(f,null,{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[...t[6]||(t[6]=[(0,o.eW)("Изменение размера изображения",-1)])]),_:1}),(0,o.bF)(p,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",V,[(0,o.Lk)("div",null,"До: "+(0,n.v_)(s.mpBefore)+" Мп",1),(0,o.Lk)("div",null,"После: "+(0,n.v_)(s.mpAfter)+" Мп",1)]),(0,o.bF)(c,{items:["Проценты","Пиксели"],modelValue:l.mode,"onUpdate:modelValue":t[0]||(t[0]=e=>l.mode=e),label:"Режим изменения",density:"compact"},null,8,["modelValue"]),(0,o.bF)(d,{modelValue:l.widthValue,"onUpdate:modelValue":t[1]||(t[1]=e=>l.widthValue=e),modelModifiers:{number:!0},label:"Ширина",type:"number",density:"compact"},null,8,["modelValue"]),(0,o.bF)(d,{modelValue:l.heightValue,"onUpdate:modelValue":t[2]||(t[2]=e=>l.heightValue=e),modelModifiers:{number:!0},label:"Высота",type:"number",density:"compact"},null,8,["modelValue"]),(0,o.bF)(h,{modelValue:l.keepRatio,"onUpdate:modelValue":t[3]||(t[3]=e=>l.keepRatio=e),label:"Сохранять пропорции",color:"black",style:{color:"black"},"hide-details":""},null,8,["modelValue"]),(0,o.bF)(c,{items:l.interpolations,"item-title":"label","item-value":"value",modelValue:l.interpolation,"onUpdate:modelValue":t[4]||(t[4]=e=>l.interpolation=e),label:"Интерполяция",density:"compact"},{"append-inner":(0,o.k6)(()=>[(0,o.bF)(u,{activator:"parent",location:"end"},{default:(0,o.k6)(()=>[(0,o.eW)((0,n.v_)(s.interpolationHint),1)]),_:1})]),_:1},8,["items","modelValue"])]),_:1}),(0,o.bF)(v,null,{default:(0,o.k6)(()=>[(0,o.bF)(g),(0,o.bF)(m,{variant:"text",onClick:s.close},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)("Отмена",-1)])]),_:1},8,["onClick"]),(0,o.bF)(m,{color:"primary",onClick:s.confirm},{default:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.eW)("Применить",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}a(116);var $={name:"ResizeComponent",props:{modelValue:Boolean,width:Number,height:Number},emits:["update:modelValue","confirm"],data(){return{mode:"Проценты",widthValue:100,heightValue:100,keepRatio:!0,interpolation:"bilinear",interpolations:[{label:"Билинейная",value:"bilinear",hint:"Плавное масштабирование, лучшее качество"},{label:"Ближайший сосед",value:"nearest",hint:"Быстро, но возможна пикселизация"}]}},computed:{open:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},mpBefore(){return(this.width*this.height/1e6).toFixed(2)},mpAfter(){const e=this.newWidth,t=this.newHeight;return(e*t/1e6).toFixed(2)},newWidth(){return"Проценты"===this.mode?Math.round(this.width*this.widthValue/100):this.widthValue},newHeight(){return"Проценты"===this.mode?Math.round(this.height*this.heightValue/100):this.heightValue},interpolationHint(){return this.interpolations.find(e=>e.value===this.interpolation)?.hint}},watch:{widthValue(e){if(this.keepRatio&&this.width>0){const t=this.height/this.width;this.heightValue=Math.round(e*t)}},modelValue(e){e&&("Пиксели"===this.mode?(this.widthValue=this.width,this.heightValue=this.height):(this.widthValue=100,this.heightValue=100))}},methods:{close(){this.open=!1},confirm(){this.$emit("confirm",{width:this.newWidth,height:this.newHeight,interpolation:this.interpolation}),this.close()}}};const I=(0,w.A)($,[["render",A]]);var U=I;const D={class:"widget-content pa-2"},T={key:0,class:"text-center text-caption py-4"},X=["onClick"],S={class:"d-flex align-center mb-1"},W={class:"preview-mini mx-2"},B={class:"text-caption font-weight-bold flex-grow-1 text-truncate"},P={key:0,class:"layer-controls px-1"},R={class:"d-flex align-center"},O={class:"text-micro ml-2"},E={class:"text-micro text-uppercase text-grey-darken-1 mb-1"},z={key:0,class:"d-flex align-center"},K={class:"preview-mini alpha mr-2"},Y={key:1,class:"text-caption text-grey italic"};function j(e,t,a,l,s,r){const c=(0,o.g2)("v-tab"),d=(0,o.g2)("v-tabs"),h=(0,o.g2)("v-divider"),u=(0,o.g2)("v-img"),p=(0,o.g2)("v-btn"),g=(0,o.g2)("v-icon"),m=(0,o.g2)("v-tooltip"),v=(0,o.g2)("v-list-item"),f=(0,o.g2)("v-select"),y=(0,o.g2)("v-slider"),b=(0,o.g2)("v-expand-transition"),w=(0,o.g2)("v-window-item"),k=(0,o.g2)("v-window"),x=(0,o.g2)("v-card");return(0,o.uX)(),(0,o.Wv)(x,{class:"layer-widget",elevation:"10",width:"280"},{default:(0,o.k6)(()=>[(0,o.bF)(d,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),density:"compact",color:"primary",grow:""},{default:(0,o.k6)(()=>[(0,o.bF)(c,{value:"layers","slider-color":"primary"},{default:(0,o.k6)(()=>[...t[2]||(t[2]=[(0,o.eW)("Слои",-1)])]),_:1}),(0,o.bF)(c,{value:"alpha"},{default:(0,o.k6)(()=>[...t[3]||(t[3]=[(0,o.eW)("Альфа",-1)])]),_:1})]),_:1},8,["modelValue"]),(0,o.bF)(h),(0,o.Lk)("div",D,[(0,o.bF)(k,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.tab=t)},{default:(0,o.k6)(()=>[(0,o.bF)(w,{value:"layers"},{default:(0,o.k6)(()=>[0===a.layers.length?((0,o.uX)(),(0,o.CE)("div",T,"Нет слоев")):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.reversedLayers,(t,l)=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:(0,n.C4)(["layer-row",{active:a.layers.length-1-l===a.activeIndex}]),onClick:t=>e.$emit("update-active",a.layers.length-1-l)},[(0,o.Lk)("div",S,[(0,o.bF)(p,{icon:t.visible?"https://cdn-icons-png.flaticon.com/512/158/158746.png":"https://cdn-icons-png.flaticon.com/512/15861/15861894.png",variant:"text",density:"comfortable",size:"small",onClick:(0,i.D$)(t=>e.$emit("toggle-visibility",a.layers.length-1-l),["stop"])},{default:(0,o.k6)(()=>[(0,o.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/158/158746.png",width:"28px"})]),_:1},8,["icon","onClick"]),(0,o.Lk)("div",W,[(0,o.Lk)("canvas",{ref_for:!0,ref:e=>r.setPreview(e,t),width:"32",height:"32"},null,512)]),(0,o.Lk)("span",B,(0,n.v_)(t.name),1),(0,o.bF)(p,{icon:"https://cdn-icons-png.flaticon.com/512/4225/4225690.png",variant:"text",color:"error",density:"comfortable",size:"small",onClick:(0,i.D$)(t=>e.$emit("remove-layer",a.layers.length-1-l),["stop"])},{default:(0,o.k6)(()=>[(0,o.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/4225/4225690.png",width:"28px"})]),_:1},8,["onClick"])]),(0,o.bF)(b,null,{default:(0,o.k6)(()=>[a.layers.length-1-l===a.activeIndex?((0,o.uX)(),(0,o.CE)("div",P,[(0,o.bF)(f,{"model-value":t.blendMode,items:e.blendModes,label:"Режим",density:"compact",variant:"outlined","hide-details":"",class:"mb-2","onUpdate:modelValue":e=>r.updateBlend(a.layers.length-1-l,e)},{item:(0,o.k6)(({props:e,item:t})=>[(0,o.bF)(v,(0,o.v6)({ref_for:!0},e),{append:(0,o.k6)(()=>[(0,o.bF)(m,{text:t.raw.desc,location:"left"},{activator:(0,o.k6)(({props:e})=>[(0,o.bF)(g,(0,o.v6)({ref_for:!0},e,{size:"x-small",class:"ml-2"}),null,16)]),_:2},1032,["text"])]),_:2},1040)]),_:1},8,["model-value","items","onUpdate:modelValue"]),(0,o.Lk)("div",R,[(0,o.bF)(g,{size:"x-small",class:"mr-2"}),(0,o.bF)(y,{"model-value":t.opacity,min:"0",max:"100",step:"1","hide-details":"",density:"compact",color:"primary","onUpdate:modelValue":e=>r.updateOpacity(a.layers.length-1-l,e)},null,8,["model-value","onUpdate:modelValue"]),(0,o.Lk)("span",O,(0,n.v_)(t.opacity)+"%",1)])])):(0,o.Q3)("",!0)]),_:2},1024)],10,X))),128))]),_:1}),(0,o.bF)(w,{value:"alpha"},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.reversedLayers,(l,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"alpha-"+l.id,class:"alpha-row pa-1"},[(0,o.Lk)("div",E,(0,n.v_)(l.name),1),l.hasAlpha?((0,o.uX)(),(0,o.CE)("div",z,[(0,o.Lk)("div",K,[(0,o.Lk)("canvas",{ref_for:!0,ref:e=>r.setAlphaPreview(e,l),width:"32",height:"32"},null,512)]),t[4]||(t[4]=(0,o.Lk)("span",{class:"text-caption flex-grow-1"},"Альфа-канал",-1)),(0,o.bF)(p,{icon:l.alphaVisible?"circle":"circle-outline",variant:"text",size:"small",onClick:(0,i.D$)(t=>e.$emit("toggle-alpha",a.layers.length-1-s),["stop"])},null,8,["icon","onClick"]),(0,o.bF)(p,{icon:"trash-can-outline",variant:"text",color:"error",size:"small",onClick:(0,i.D$)(t=>e.$emit("remove-alpha",a.layers.length-1-s),["stop"])},null,8,["onClick"])])):((0,o.uX)(),(0,o.CE)("div",Y,"Нет альфа-канала")),(0,o.bF)(h,{class:"my-1"})]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var G={props:["layers","activeIndex"],data:()=>({tab:"layers",blendModes:[{title:"Обычный",value:"normal",desc:"Верхний слой полностью перекрывает нижний."},{title:"Умножение",value:"multiply",desc:"Цвета перемножаются, результат всегда темнее. Полезно для теней."},{title:"Экран",value:"screen",desc:"Противоположно умножению. Результат всегда светлее."},{title:"Перекрытие",value:"overlay",desc:"Умножает или осветляет цвета в зависимости от базового слоя."}]}),computed:{reversedLayers(){return[...this.layers].reverse()}},methods:{setPreview(e,t){if(!e)return;const a=e.getContext("2d"),i=new ImageData(new Uint8ClampedArray(t.pixels),t.width,t.height),o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(i,0,0),a.clearRect(0,0,32,32),a.drawImage(o,0,0,32,32)},setAlphaPreview(e,t){if(!e)return;const a=e.getContext("2d"),i=new Uint8ClampedArray(t.pixels.length);for(let l=0;l<t.pixels.length;l+=4){const e=t.pixels[l+3];i[l]=i[l+1]=i[l+2]=e,i[l+3]=255}const o=new ImageData(i,t.width,t.height),n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(o,0,0),a.drawImage(n,0,0,32,32)},updateOpacity(e,t){this.$emit("update-opacity",{idx:e,val:t})},updateBlend(e,t){this.$emit("update-blend",{idx:e,mode:t})}}};const H=(0,w.A)(G,[["render",j],["__scopeId","data-v-5889ff01"]]);var Q=H,Z={name:"App",components:{MenuComponent:x,CanvasComponent:M,ResizeComponent:U,LayersComponent:Q},data(){return{imageSrc:null,scalePercent:100,showResize:!1,activeTool:"hand",colorA:null,colorB:null,spaceInfo:{RGB:{title:"RGB",axes:"Red, Green, Blue: 0-255."},XYZ:{title:"XYZ",axes:"X: ~0-95, Y (Яркость): 0-100, Z: ~0-108."},Lab:{title:"Lab",axes:"L (Светлота): 0-100, a: (Зел/Крас), b: (Син/Желт)."},OKLch:{title:"OKLch",axes:"L: 0-1, C (Насыщенность): 0-0.4, h (Тон): 0-360°."}},layers:[],activeLayerIndex:0}},computed:{contrastValue(){return this.colorA&&this.colorB?this.calculateContrast(this.colorA,this.colorB).toFixed(2):"0"},statusText(){if(0===this.layers.length)return"Загрузите изображение";const e=this.layers[this.activeLayerIndex];return`Слой: ${e?.name}   |   Размер: ${e?.width}x${e?.height} px   |   Глубина: ${e?.depth} бит`}},mounted(){window.addEventListener("keydown",this.handleGlobalKeyDown)},beforeUnmount(){window.removeEventListener("keydown",this.handleGlobalKeyDown)},methods:{onLayerAdded(e){if(this.layers.length>=2)return;const t={id:Date.now(),name:0===this.layers.length?"Слой 1":"Слой 2",pixels:e.pixels||this.extractPixels(e.src,e.width,e.height),width:e.width,height:e.height,depth:e.depth,opacity:100,visible:!0,blendMode:"normal",alphaVisible:!0,hasAlpha:!0,preview:""};this.layers.push(t),this.activeLayerIndex=this.layers.length-1},onColorLayerAdded(e){if(0===this.layers.length)return;const t=this.layers[0],a=t.width*t.height*4,i=new Uint8ClampedArray(a);for(let o=0;o<a;o+=4)i[o]=e.r,i[o+1]=e.g,i[o+2]=e.b,i[o+3]=255;this.onLayerAdded({pixels:i,width:t.width,height:t.height})},extractPixels(e,t,a){const i=document.createElement("canvas");i.width=t,i.height=a;const o=i.getContext("2d"),n=new Image;return n.src=e,o.drawImage(n,0,0),o.getImageData(0,0,t,a).data},toggleVisibility(e){this.layers[e].visible=!this.layers[e].visible},toggleAlpha(e){this.layers[e].alphaVisible=!this.layers[e].alphaVisible},removeLayer(e){this.layers.splice(e,1),this.activeLayerIndex=Math.max(0,this.layers.length-1)},removeAlpha(e){const t=this.layers[e];for(let a=3;a<t.pixels.length;a+=4)t.pixels[a]=255;t.hasAlpha=!1},updateOpacity({idx:e,val:t}){this.layers[e].opacity=t},updateBlend({idx:e,mode:t}){this.layers[e].blendMode=t},handleGlobalKeyDown(e){const t=e.key.toLowerCase();"h"===t&&(this.activeTool="hand"),"i"===t&&(this.activeTool="eyedropper")},onImageLoaded(e){this.imageSrc=e},onScaleChanged(e){this.scalePercent=e},applyResize(e){0!==this.layers.length&&(this.layers=this.layers.map(t=>{const a=this.$refs.canvas.runResizeAlgo(t.pixels,t.width,t.height,e.width,e.height,e.interpolation);return{...t,pixels:a,width:e.width,height:e.height}}),this.$nextTick(()=>{this.$refs.canvas.fitToScreen()}))},onPickColor({color:e,slot:t}){"A"===t?this.colorA=e:this.colorB=e},calculateContrast(e,t){if(!e||!t)return 0;const a=e=>{let t=e.r/255,a=e.g/255,i=e.b/255;return t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),a=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),i=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*t+.7152*a+.0722*i},i=a(e),o=a(t);return(Math.max(i,o)+.05)/(Math.min(i,o)+.05)},rgbString(e){return`rgb(${e.r}, ${e.g}, ${e.b})`},getSpaceValues(e,t){const{r:a,g:i,b:o}=t;let n=a/255,l=i/255,s=o/255;const r=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),c=r(n),d=r(l),h=r(s);if("RGB"===e)return`${a},${i},${o}`;const u=100*(.4124*c+.3576*d+.1805*h),p=100*(.2126*c+.7152*d+.0722*h),g=100*(.0193*c+.1192*d+.9505*h);if("XYZ"===e)return`${u.toFixed(0)},${p.toFixed(0)},${g.toFixed(0)}`;const m=e=>e>.008856?Math.pow(e,1/3):7.787*e+16/116,v=116*m(p/100)-16,f=500*(m(u/95.047)-m(p/100)),y=200*(m(p/100)-m(g/108.883));if("Lab"===e)return`${v.toFixed(0)},${f.toFixed(0)},${y.toFixed(0)}`;const b=Math.sqrt(f*f+y*y);let w=Math.atan2(y,f)*(180/Math.PI);return w<0&&(w+=360),"OKLch"===e?`${(v/100).toFixed(2)},${(b/100).toFixed(2)},${w.toFixed(0)}°`:""}}};const N=(0,w.A)(Z,[["render",f],["__scopeId","data-v-4396fa2e"]]);var q=N,J=(a(5524),a(5753)),ee=a(1839),te=a(3425),ae=a(465);const ie=(0,J.$N)({components:ee,directives:te,icons:{defaultSet:"mdi",aliases:ae.z,sets:{mdi:ae.r}}});(0,i.Ef)(q).use(ie).mount("#app")}},t={};function a(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,i,o,n){if(!i){var l=1/0;for(d=0;d<e.length;d++){i=e[d][0],o=e[d][1],n=e[d][2];for(var s=!0,r=0;r<i.length;r++)(!1&n||l>=n)&&Object.keys(a.O).every(function(e){return a.O[e](i[r])})?i.splice(r--,1):(s=!1,n<l&&(l=n));if(s){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,o,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,n,l=i[0],s=i[1],r=i[2],c=0;if(l.some(function(t){return 0!==e[t]})){for(o in s)a.o(s,o)&&(a.m[o]=s[o]);if(r)var d=r(a)}for(t&&t(i);c<l.length;c++)n=l[c],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},i=self["webpackChunkphotoshop"]=self["webpackChunkphotoshop"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[504],function(){return a(2701)});i=a.O(i)})();
//# sourceMappingURL=app.947185ae.js.map