(function(){"use strict";var e={4152:function(e,t,a){var l=a(5130),i=a(6768),o=a(4232);const n={key:0,class:"d-flex align-center overflow-hidden flex-grow-1"},s={class:"coord-label mr-3"},r={class:"d-flex space-group"},d={class:"space-tag"},c={class:"text-caption"},h={key:1},u={key:2,class:"d-flex align-center overflow-hidden flex-grow-1 justify-end"},p={class:"d-flex space-group"},g={class:"space-tag"},m={class:"text-caption"},v={class:"coord-label ml-3"};function y(e,t,a,l,y,f){const b=(0,i.g2)("MenuComponent"),x=(0,i.g2)("ResizeComponent"),k=(0,i.g2)("CanvasComponent"),w=(0,i.g2)("LayersComponent"),C=(0,i.g2)("KernelDialog"),L=(0,i.g2)("CurvesDialog"),F=(0,i.g2)("v-footer"),V=(0,i.g2)("v-tooltip"),_=(0,i.g2)("v-chip"),M=(0,i.g2)("v-app");return(0,i.uX)(),(0,i.Wv)(M,null,{default:(0,i.k6)(()=>[(0,i.bF)(b,{"scale-percent":y.scalePercent,"active-tool":y.activeTool,"can-add-layer":y.layers.length<2,onImageLoaded:f.onLayerAdded,onScaleChanged:f.onScaleChanged,onOpenResize:t[0]||(t[0]=e=>y.showResize=!0),onToolChanged:t[1]||(t[1]=e=>y.activeTool=e),onAddColorLayer:f.onColorLayerAdded,onOpenCurves:t[2]||(t[2]=e=>f.openCurves(!1)),onExport:f.handleExport,layersCount:y.layers.length,"layers-count":y.layers.length,"active-layer-index":y.activeLayerIndex,onOpenKernelDialog:t[3]||(t[3]=e=>y.showKernel=!0)},null,8,["scale-percent","active-tool","can-add-layer","onImageLoaded","onScaleChanged","onAddColorLayer","onExport","layersCount","layers-count","active-layer-index"]),(0,i.bF)(x,{modelValue:y.showResize,"onUpdate:modelValue":t[4]||(t[4]=e=>y.showResize=e),width:y.layers[0]?.width||0,height:y.layers[0]?.height||0,onConfirm:f.applyResize},null,8,["modelValue","width","height","onConfirm"]),(0,i.bF)(k,{ref:"canvas",layers:y.layers,"image-src":y.imageSrc,"scale-percent":y.scalePercent,"active-tool":y.activeTool,onPickColor:f.onPickColor,"active-index":y.activeLayerIndex,"active-lut":y.tempLut,"lut-target":y.curvesAlphaMode?"alpha":"rgb"},null,8,["layers","image-src","scale-percent","active-tool","onPickColor","active-index","active-lut","lut-target"]),(0,i.bF)(w,{layers:y.layers,"active-index":y.activeLayerIndex,onUpdateActive:t[5]||(t[5]=e=>y.activeLayerIndex=e),onToggleVisibility:f.toggleVisibility,onToggleAlpha:f.toggleAlpha,onRemoveLayer:f.removeLayer,onRemoveAlpha:f.removeAlpha,onUpdateOpacity:f.updateOpacity,onUpdateBlend:f.updateBlend,onOpenAlphaCurves:t[6]||(t[6]=e=>f.openCurves(!0))},null,8,["layers","active-index","onToggleVisibility","onToggleAlpha","onRemoveLayer","onRemoveAlpha","onUpdateOpacity","onUpdateBlend"]),(0,i.bF)(C,{modelValue:y.showKernel,"onUpdate:modelValue":t[7]||(t[7]=e=>y.showKernel=e),"active-layer":y.layers[y.activeLayerIndex],onApply:f.onKernelApply,onPreview:f.onKernelPreview,onRestore:f.onKernelRestore},null,8,["modelValue","active-layer","onApply","onPreview","onRestore"]),(0,i.bF)(L,{modelValue:y.showCurves,"onUpdate:modelValue":t[8]||(t[8]=e=>y.showCurves=e),layer:y.layers[y.activeLayerIndex],"is-alpha-mode":y.curvesAlphaMode,onPreview:f.handleCurvesPreview,onConfirm:f.applyCurves},null,8,["modelValue","layer","is-alpha-mode","onPreview","onConfirm"]),(0,i.bF)(F,{app:"",height:"32",color:"grey-darken-4",class:"white--text px-4 align-center justify-center"},{default:(0,i.k6)(()=>[(0,i.eW)((0,o.v_)(f.statusText),1)]),_:1}),"eyedropper"===y.activeTool?((0,i.uX)(),(0,i.Wv)(F,{key:0,app:"",height:"32",color:"grey-darken-4",class:"white--text px-2 d-flex align-center justify-space-between eyedropper-footer"},{default:(0,i.k6)(()=>[y.colorA?((0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",{class:"swatch-box",style:(0,o.Tr)({background:f.rgbString(y.colorA)}),title:"Цвет A"},null,4),(0,i.Lk)("span",s,[t[9]||(t[9]=(0,i.Lk)("strong",null,"Цвет 1",-1)),(0,i.eW)(" ("+(0,o.v_)(y.colorA.x)+", "+(0,o.v_)(y.colorA.y)+") ",1)]),(0,i.Lk)("div",r,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["RGB","XYZ","Lab","OKLch"],e=>(0,i.bF)(V,{key:e,location:"top",offset:"10"},{activator:(0,i.k6)(({props:t})=>[(0,i.Lk)("span",(0,i.v6)({ref_for:!0},t,{class:"space-val"}),[(0,i.Lk)("span",d,(0,o.v_)(e),1),(0,i.eW)(" "+(0,o.v_)(f.getSpaceValues(e,y.colorA)),1)],16)]),default:(0,i.k6)(()=>[(0,i.Lk)("div",c,[(0,i.Lk)("strong",null,(0,o.v_)(y.spaceInfo[e].title),1),t[10]||(t[10]=(0,i.Lk)("br",null,null,-1)),(0,i.eW)(" "+(0,o.v_)(y.spaceInfo[e].axes),1)])]),_:2},1024)),64))])])):(0,i.Q3)("",!0),y.colorA&&y.colorB?((0,i.uX)(),(0,i.CE)("div",h,[(0,i.bF)(_,{size:"small",color:"#008FFF"},{default:(0,i.k6)(()=>[(0,i.eW)(" Контраст: "+(0,o.v_)(f.contrastValue)+":1 ",1)]),_:1})])):(0,i.Q3)("",!0),y.colorB?((0,i.uX)(),(0,i.CE)("div",u,[(0,i.Lk)("div",p,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["RGB","XYZ","Lab","OKLch"],e=>(0,i.bF)(V,{key:e,location:"top",offset:"10"},{activator:(0,i.k6)(({props:t})=>[(0,i.Lk)("span",(0,i.v6)({ref_for:!0},t,{class:"space-val"}),[(0,i.Lk)("span",g,(0,o.v_)(e),1),(0,i.eW)(" "+(0,o.v_)(f.getSpaceValues(e,y.colorB)),1)],16)]),default:(0,i.k6)(()=>[(0,i.Lk)("div",m,[(0,i.Lk)("strong",null,(0,o.v_)(y.spaceInfo[e].title),1),t[11]||(t[11]=(0,i.Lk)("br",null,null,-1)),(0,i.eW)(" "+(0,o.v_)(y.spaceInfo[e].axes),1)])]),_:2},1024)),64))]),(0,i.Lk)("span",v,[(0,i.eW)(" ("+(0,o.v_)(y.colorB.x)+", "+(0,o.v_)(y.colorB.y)+") ",1),t[12]||(t[12]=(0,i.Lk)("strong",null,"Цвет 2",-1))]),(0,i.Lk)("div",{class:"swatch-box ml-2",style:(0,o.Tr)({background:f.rgbString(y.colorB)}),title:"Цвет B"},null,4)])):(0,i.Q3)("",!0)]),_:1})):(0,i.Q3)("",!0)]),_:1})}a(4114),a(6573),a(8100),a(7936),a(8111),a(1701),a(9577),a(1549),a(9797),a(9631),a(5623),a(4603),a(7566),a(8721);function f(e,t,a,l,n,s){const r=(0,i.g2)("v-toolbar-title"),d=(0,i.g2)("v-btn"),c=(0,i.g2)("v-list-item-title"),h=(0,i.g2)("v-list-item"),u=(0,i.g2)("v-divider"),p=(0,i.g2)("v-list"),g=(0,i.g2)("v-menu"),m=(0,i.g2)("v-color-picker"),v=(0,i.g2)("v-img"),y=(0,i.g2)("v-tooltip"),f=(0,i.g2)("v-select"),b=(0,i.g2)("v-app-bar");return(0,i.uX)(),(0,i.Wv)(b,{app:"",color:"primary"},{default:(0,i.k6)(()=>[(0,i.bF)(r,null,{default:(0,i.k6)(()=>[...t[9]||(t[9]=[(0,i.eW)("Онлайн Фотошоп",-1)])]),_:1}),(0,i.bF)(d,{variant:"text",disabled:!s.isSingleLayerSelected,onClick:t[0]||(t[0]=t=>e.$emit("open-kernel-dialog"))},{default:(0,i.k6)(()=>[...t[10]||(t[10]=[(0,i.eW)(" Коррекция ",-1)])]),_:1},8,["disabled"]),(0,i.bF)(g,{transition:"slide-y-transition"},{activator:(0,i.k6)(({props:e})=>[(0,i.bF)(d,(0,i.v6)(e,{variant:"text",disabled:0===a.layersCount}),{default:(0,i.k6)(()=>[...t[11]||(t[11]=[(0,i.eW)("Экспорт",-1)])]),_:1},16,["disabled"])]),default:(0,i.k6)(()=>[(0,i.bF)(p,{density:"compact","bg-color":"#222",class:"text-white"},{default:(0,i.k6)(()=>[(0,i.bF)(h,{onClick:t[1]||(t[1]=t=>e.$emit("export","png"))},{default:(0,i.k6)(()=>[(0,i.bF)(c,null,{default:(0,i.k6)(()=>[...t[12]||(t[12]=[(0,i.eW)("Сохранить как PNG",-1)])]),_:1})]),_:1}),(0,i.bF)(h,{onClick:t[2]||(t[2]=t=>e.$emit("export","jpg"))},{default:(0,i.k6)(()=>[(0,i.bF)(c,null,{default:(0,i.k6)(()=>[...t[13]||(t[13]=[(0,i.eW)("Сохранить как JPG",-1)])]),_:1})]),_:1}),(0,i.bF)(u,{class:"my-1"}),(0,i.bF)(h,{onClick:t[3]||(t[3]=t=>e.$emit("export","gb7"))},{default:(0,i.k6)(()=>[(0,i.bF)(c,null,{default:(0,i.k6)(()=>[...t[14]||(t[14]=[(0,i.eW)("Сохранить как GB7",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),(0,i.bF)(d,{disabled:!a.canAddLayer,onClick:s.triggerFileInput,class:"mr-4"},{default:(0,i.k6)(()=>[(0,i.eW)((0,o.v_)(0===a.layersCount?"Загрузить изображение":"Добавить слой"),1)]),_:1},8,["disabled","onClick"]),a.layersCount>0&&a.canAddLayer?((0,i.uX)(),(0,i.Wv)(g,{key:0},{activator:(0,i.k6)(({props:a})=>[(0,i.bF)(d,(0,i.v6)(a,{onClick:t[4]||(t[4]=t=>e.$emit("add-color-layer",{r:0,g:150,b:255})),class:"ml-2"}),{default:(0,i.k6)(()=>[...t[15]||(t[15]=[(0,i.eW)("Заливка цветом",-1)])]),_:1},16)]),default:(0,i.k6)(()=>[(0,i.bF)(m,{"onUpdate:modelValue":s.onColorSelect},null,8,["onUpdate:modelValue"])]),_:1})):(0,i.Q3)("",!0),(0,i.bF)(y,{text:"Рука (H)",location:"bottom"},{activator:(0,i.k6)(({props:l})=>[(0,i.bF)(d,(0,i.v6)(l,{icon:"",color:"hand"===a.activeTool?"white":"white-darken-2",variant:"hand"===a.activeTool?"tonal":"text",onClick:t[5]||(t[5]=t=>e.$emit("tool-changed","hand"))}),{default:(0,i.k6)(()=>[(0,i.bF)(v,{src:"https://cdn-icons-png.flaticon.com/512/658/658022.png",width:"28px"})]),_:1},16,["color","variant"])]),_:1}),(0,i.bF)(y,{text:"Пипетка (I)",location:"bottom"},{activator:(0,i.k6)(({props:l})=>[(0,i.bF)(d,(0,i.v6)(l,{icon:"",color:"eyedropper"===a.activeTool?"white":"white-darken-2",variant:"eyedropper"===a.activeTool?"tonal":"text",onClick:t[6]||(t[6]=t=>e.$emit("tool-changed","eyedropper"))}),{default:(0,i.k6)(()=>[(0,i.bF)(v,{src:"https://cdn-icons-png.flaticon.com/512/4347/4347420.png",width:"28px"})]),_:1},16,["color","variant"])]),_:1}),(0,i.bF)(d,{class:"ml-2",onClick:t[7]||(t[7]=t=>e.$emit("open-resize"))},{default:(0,i.k6)(()=>[...t[16]||(t[16]=[(0,i.eW)(" Изменить размер ",-1)])]),_:1}),(0,i.bF)(f,{items:n.scales,"model-value":n.currentScale,label:"Масштаб",density:"compact",style:{"max-width":"120px"},"onUpdate:modelValue":s.onScaleChange},null,8,["items","model-value","onUpdate:modelValue"]),(0,i.Lk)("input",{ref:"fileInput",type:"file",accept:".jpg,.jpeg,.png,.gb7",hidden:"",onChange:t[8]||(t[8]=(...e)=>s.onFileChange&&s.onFileChange(...e))},null,544)]),_:1})}var b={name:"MenuComponent",emits:["tool-changed"],props:["scalePercent","activeTool","canAddLayer","layersCount","activeLayerIndex"],data(){return{scales:[12,25,50,75,100,150,200,300],currentScale:100}},computed:{isSingleLayerSelected(){return-1!==this.activeLayerIndex&&this.layersCount>0}},mounted(){window.addEventListener("keydown",e=>{"h"===e.key.toLowerCase()&&this.setTool("hand"),"i"===e.key.toLowerCase()&&this.setTool("eyedropper")})},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},watch:{scalePercent(e){this.currentScale=e}},methods:{onExportClick(e){this.$emit("export",e)},onColorSelect(e){this.$emit("add-color-layer",e.rgba)},setTool(e){this.$emit("tool-changed",e)},onKeyDown(e){const t=e.key.toLowerCase();"h"===t&&this.setTool("hand"),"i"===t&&this.setTool("eyedropper")},triggerFileInput(){this.$refs.fileInput.click()},onScaleChange(e){this.currentScale=e,this.$emit("scale-changed",Number(e))},async onFileChange(e){const t=e.target.files[0];if(!t)return;const a=t.name.split(".").pop().toLowerCase();if(["jpg","jpeg","png"].includes(a)){const e=new FileReader;e.onload=e=>{const t=new Image;t.onload=()=>{this.$emit("image-loaded",{type:"image",src:e.target.result,width:t.width,height:t.height,depth:screen.colorDepth})},t.src=e.target.result},e.readAsDataURL(t)}else if("gb7"===a){const e=await t.arrayBuffer(),a=new DataView(e);if(71!==a.getUint8(0)||66!==a.getUint8(1)||55!==a.getUint8(2)||29!==a.getUint8(3))return void alert("Неверный формат GB7");const l=a.getUint8(5),i=a.getUint16(6,!1),o=a.getUint16(8,!1),n=new Uint8ClampedArray(i*o*4);let s=12;for(let t=0;t<i*o;t++){const e=a.getUint8(s++),i=127&e,o=(128&e)>>7,r=2*i;n[4*t]=r,n[4*t+1]=r,n[4*t+2]=r,n[4*t+3]=l&&0===o?0:255}this.$emit("image-loaded",{type:"gb7",width:i,height:o,pixels:n,depth:7})}}}},x=a(1241);const k=(0,x.A)(b,[["render",f],["__scopeId","data-v-51e01e34"]]);var w=k;const C={key:0,class:"text-grey"};function L(e,t,a,n,s,r){return(0,i.uX)(),(0,i.CE)("div",{class:"canvas-container",ref:"container",onMousedown:t[1]||(t[1]=(...e)=>r.onMouseDown&&r.onMouseDown(...e)),onMousemove:t[2]||(t[2]=(...e)=>r.onMouseMove&&r.onMouseMove(...e)),onMouseup:t[3]||(t[3]=(...e)=>r.onMouseUp&&r.onMouseUp(...e)),onMouseleave:t[4]||(t[4]=(...e)=>r.onMouseUp&&r.onMouseUp(...e))},[(0,i.bo)((0,i.Lk)("canvas",{ref:"canvas",onClick:t[0]||(t[0]=(...e)=>r.onClick&&r.onClick(...e)),style:(0,o.Tr)(r.canvasStyle)},null,4),[[l.aG,a.layers.length>0]]),0===a.layers.length?((0,i.uX)(),(0,i.CE)("div",C,"Загрузите изображение для начала работы")):(0,i.Q3)("",!0)],544)}a(7588);var F={name:"CanvasComponent",props:{imageSrc:Object,scalePercent:Number,activeTool:String,layers:{type:Array,default:()=>[]},activeLut:Uint8ClampedArray,lutTarget:String},emits:["pick-color","scale-changed"],data(){return{originalPixels:null,originalWidth:0,originalHeight:0,scale:1,ctx:null,imageData:null,colorA:null,colorB:null,offsetX:0,offsetY:0,isDragging:!1,lastMouseX:0,lastMouseY:0,viewPadding:50}},computed:{canvasStyle(){return{transform:`translate(${this.offsetX}px, ${this.offsetY}px)`,cursor:"hand"===this.activeTool?this.isDragging?"grabbing":"grab":"crosshair",transition:this.isDragging?"none":"transform 0.1s ease-out"}}},mounted(){window.addEventListener("keydown",this.onKeyDown)},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},watch:{imageSrc(e){e&&("image"===e.type?this.loadStandardImage(e.src):"gb7"===e.type&&this.loadGB7(e))},scalePercent(e){this.scale=e/100,this.redraw()},layers:{handler(e){e.length>0&&(1===e.length&&1===this.scale?this.fitToScreen():this.redraw())},deep:!0}},methods:{loadStandardImage(e){const t=new Image;t.onload=()=>{this.originalWidth=t.width,this.originalHeight=t.height;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=e.getContext("2d");a.drawImage(t,0,0),this.originalPixels=a.getImageData(0,0,t.width,t.height).data,this.fitToScreen()},t.src=e},loadGB7({width:e,height:t,pixels:a}){this.originalWidth=e,this.originalHeight=t,this.originalPixels=a,this.fitToScreen()},resetPosition(){this.offsetX=0,this.offsetY=0},constrainOffset(e,t){const a=this.$refs.container,l=this.$refs.canvas;if(!a||!l)return{x:e,y:t};const i=a.clientWidth,o=a.clientHeight,n=l.width,s=l.height,r=n/2+i/2-this.viewPadding,d=s/2+o/2-this.viewPadding;return{x:Math.max(-r,Math.min(r,e)),y:Math.max(-d,Math.min(d,t))}},onMouseDown(e){"hand"===this.activeTool&&(this.isDragging=!0,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY)},onMouseMove(e){if(!this.isDragging||"hand"!==this.activeTool)return;const t=e.clientX-this.lastMouseX,a=e.clientY-this.lastMouseY,l=this.constrainOffset(this.offsetX+t,this.offsetY+a);this.offsetX=l.x,this.offsetY=l.y,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY},onMouseUp(){this.isDragging=!1},onKeyDown(e){if("hand"!==this.activeTool)return;const t=e.shiftKey?50:10;let a=0,l=0;if("ArrowLeft"===e.key&&(a=-t),"ArrowRight"===e.key&&(a=t),"ArrowUp"===e.key&&(l=-t),"ArrowDown"===e.key&&(l=t),0!==a||0!==l){e.preventDefault();const t=this.constrainOffset(this.offsetX+a,this.offsetY+l);this.offsetX=t.x,this.offsetY=t.y}},fitToScreen(){if(!this.layers||0===this.layers.length)return;const e=this.$refs.container,t=this.layers[0],a=e.clientWidth-100,l=e.clientHeight-100,i=Math.min(a/t.width,l/t.height,1);this.scale=i,this.$emit("scale-changed",Math.round(100*i)),this.redraw()},redraw(){if(!this.layers||0===this.layers.length)return;const e=this.layers[0],t=Math.round(e.width*this.scale),a=Math.round(e.height*this.scale),l=this.$refs.canvas;if(!l)return;l.width=t,l.height=a;const i=l.getContext("2d",{willReadFrequently:!0}),o=new Uint8ClampedArray(t*a*4);this.layers.forEach((e,l)=>{if(!e.visible)return;let i=e.pixels;if(l===this.activeIndex&&this.activeLut){i=new Uint8ClampedArray(e.pixels);for(let e=0;e<i.length;e+=4)"alpha"===this.lutTarget?i[e+3]=this.activeLut[i[e+3]]:(i[e]=this.activeLut[i[e]],i[e+1]=this.activeLut[i[e+1]],i[e+2]=this.activeLut[i[e+2]])}const n=this.bilinear(e.pixels,e.width,e.height,t,a);if(0===l){const t=e.opacity/100;for(let a=0;a<o.length;a+=4){o[a]=n[a],o[a+1]=n[a+1],o[a+2]=n[a+2];const l=e.alphaVisible?n[a+3]:255;o[a+3]=l*t}}else this.blendLayers(o,n,e)}),this.imageData=new ImageData(o,t,a),i.putImageData(this.imageData,0,0)},blendLayers(e,t,a){const l=a.opacity/100;for(let i=0;i<e.length;i+=4){const o=e[i+3]/255,n=t[i],s=t[i+1],r=t[i+2],d=(a.alphaVisible?t[i+3]/255:1)*l,c=e[i],h=e[i+1],u=e[i+2];let p,g,m;const v=c/255,y=n/255,f=h/255,b=s/255,x=u/255,k=r/255;if("multiply"===a.blendMode)p=v*y,g=f*b,m=x*k;else if("screen"===a.blendMode)p=1-(1-v)*(1-y),g=1-(1-f)*(1-b),m=1-(1-x)*(1-k);else if("overlay"===a.blendMode){const e=(e,t)=>e<.5?2*e*t:1-2*(1-e)*(1-t);p=e(v,y),g=e(f,b),m=e(x,k)}else p=y,g=b,m=k;const w=d+o*(1-d);w>0&&(e[i]=(255*p*d+c*o*(1-d))/w,e[i+1]=(255*g*d+h*o*(1-d))/w,e[i+2]=(255*m*d+u*o*(1-d))/w,e[i+3]=255*w)}},runResizeAlgo(e,t,a,l,i,o){return"nearest"===o?this.nearest(e,t,a,l,i):this.bilinear(e,t,a,l,i)},bilinear(e,t,a,l,i){const o=new Uint8ClampedArray(l*i*4);for(let n=0;n<i;n++)for(let s=0;s<l;s++){const r=(s+.5)*t/l-.5,d=(n+.5)*a/i-.5,c=Math.floor(r),h=Math.floor(d),u=Math.min(c+1,t-1),p=Math.min(h+1,a-1),g=r-c,m=d-h;for(let a=0;a<4;a++){const i=4*(h*t+c)+a,r=4*(h*t+u)+a,d=4*(p*t+c)+a,v=4*(p*t+u)+a;o[4*(n*l+s)+a]=e[i]*(1-g)*(1-m)+e[r]*g*(1-m)+e[d]*(1-g)*m+e[v]*g*m}}return o},nearest(e,t,a,l,i){const o=new Uint8ClampedArray(l*i*4);for(let n=0;n<i;n++)for(let s=0;s<l;s++){const r=Math.floor(s*t/l),d=Math.floor(n*a/i),c=4*(d*t+r),h=4*(n*l+s);o[h]=e[c],o[h+1]=e[c+1],o[h+2]=e[c+2],o[h+3]=e[c+3]}return o},resizeImage(e,t,a){const l="nearest"===a?this.nearest:this.bilinear,i=l(this.originalPixels,this.originalWidth,this.originalHeight,e,t);this.originalPixels=i,this.originalWidth=e,this.originalHeight=t,this.scale=1,this.redraw()},onClick(e){if("eyedropper"!==this.activeTool)return;if(!this.imageData)return;e.preventDefault();const t=this.$refs.canvas.getBoundingClientRect(),a=Math.floor(e.clientX-t.left),l=Math.floor(e.clientY-t.top);if(a<0||l<0||a>=this.imageData.width||l>=this.imageData.height)return;const i=4*(l*this.imageData.width+a),o={r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],x:a,y:l},n=e.altKey||e.ctrlKey||e.shiftKey,s=n?"B":"A";console.log(`Picked color for slot ${s}:`,o),this.$emit("pick-color",{color:o,slot:s})}}};const V=(0,x.A)(F,[["render",L],["__scopeId","data-v-a5980daa"]]);var _=V;const M={class:"mb-3"};function A(e,t,a,l,n,s){const r=(0,i.g2)("v-card-title"),d=(0,i.g2)("v-select"),c=(0,i.g2)("v-text-field"),h=(0,i.g2)("v-checkbox"),u=(0,i.g2)("v-tooltip"),p=(0,i.g2)("v-card-text"),g=(0,i.g2)("v-spacer"),m=(0,i.g2)("v-btn"),v=(0,i.g2)("v-card-actions"),y=(0,i.g2)("v-card"),f=(0,i.g2)("v-dialog");return(0,i.uX)(),(0,i.Wv)(f,{modelValue:s.open,"onUpdate:modelValue":t[5]||(t[5]=e=>s.open=e),"max-width":"520"},{default:(0,i.k6)(()=>[(0,i.bF)(y,null,{default:(0,i.k6)(()=>[(0,i.bF)(r,null,{default:(0,i.k6)(()=>[...t[6]||(t[6]=[(0,i.eW)("Изменение размера изображения",-1)])]),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)(()=>[(0,i.Lk)("div",M,[(0,i.Lk)("div",null,"До: "+(0,o.v_)(s.mpBefore)+" Мп",1),(0,i.Lk)("div",null,"После: "+(0,o.v_)(s.mpAfter)+" Мп",1)]),(0,i.bF)(d,{items:["Проценты","Пиксели"],modelValue:n.mode,"onUpdate:modelValue":t[0]||(t[0]=e=>n.mode=e),label:"Режим изменения",density:"compact"},null,8,["modelValue"]),(0,i.bF)(c,{modelValue:n.widthValue,"onUpdate:modelValue":t[1]||(t[1]=e=>n.widthValue=e),modelModifiers:{number:!0},label:"Ширина",type:"number",density:"compact"},null,8,["modelValue"]),(0,i.bF)(c,{modelValue:n.heightValue,"onUpdate:modelValue":t[2]||(t[2]=e=>n.heightValue=e),modelModifiers:{number:!0},label:"Высота",type:"number",density:"compact"},null,8,["modelValue"]),(0,i.bF)(h,{modelValue:n.keepRatio,"onUpdate:modelValue":t[3]||(t[3]=e=>n.keepRatio=e),label:"Сохранять пропорции",color:"black",style:{color:"black"},"hide-details":""},null,8,["modelValue"]),(0,i.bF)(d,{items:n.interpolations,"item-title":"label","item-value":"value",modelValue:n.interpolation,"onUpdate:modelValue":t[4]||(t[4]=e=>n.interpolation=e),label:"Интерполяция",density:"compact"},{"append-inner":(0,i.k6)(()=>[(0,i.bF)(u,{activator:"parent",location:"end"},{default:(0,i.k6)(()=>[(0,i.eW)((0,o.v_)(s.interpolationHint),1)]),_:1})]),_:1},8,["items","modelValue"])]),_:1}),(0,i.bF)(v,null,{default:(0,i.k6)(()=>[(0,i.bF)(g),(0,i.bF)(m,{variant:"text",onClick:s.close},{default:(0,i.k6)(()=>[...t[7]||(t[7]=[(0,i.eW)("Отмена",-1)])]),_:1},8,["onClick"]),(0,i.bF)(m,{color:"primary",onClick:s.confirm},{default:(0,i.k6)(()=>[...t[8]||(t[8]=[(0,i.eW)("Применить",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}a(116);var U={name:"ResizeComponent",props:{modelValue:Boolean,width:Number,height:Number},emits:["update:modelValue","confirm"],data(){return{mode:"Проценты",widthValue:100,heightValue:100,keepRatio:!0,interpolation:"bilinear",interpolations:[{label:"Билинейная",value:"bilinear",hint:"Плавное масштабирование, лучшее качество"},{label:"Ближайший сосед",value:"nearest",hint:"Быстро, но возможна пикселизация"}]}},computed:{open:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},mpBefore(){return(this.width*this.height/1e6).toFixed(2)},mpAfter(){const e=this.newWidth,t=this.newHeight;return(e*t/1e6).toFixed(2)},newWidth(){return"Проценты"===this.mode?Math.round(this.width*this.widthValue/100):this.widthValue},newHeight(){return"Проценты"===this.mode?Math.round(this.height*this.heightValue/100):this.heightValue},interpolationHint(){return this.interpolations.find(e=>e.value===this.interpolation)?.hint}},watch:{widthValue(e){if(this.keepRatio&&this.width>0){const t=this.height/this.width;this.heightValue=Math.round(e*t)}},modelValue(e){e&&("Пиксели"===this.mode?(this.widthValue=this.width,this.heightValue=this.height):(this.widthValue=100,this.heightValue=100))}},methods:{close(){this.open=!1},confirm(){this.$emit("confirm",{width:this.newWidth,height:this.newHeight,interpolation:this.interpolation}),this.close()}}};const I=(0,x.A)(U,[["render",A]]);var $=I;const D={class:"widget-content pa-2"},P={key:0,class:"text-center text-caption py-4"},X=["onClick"],B={class:"d-flex align-center mb-1"},W={class:"preview-mini mx-2"},S={class:"text-caption font-weight-bold flex-grow-1 text-truncate"},T={key:0,class:"layer-controls px-1"},E={class:"d-flex align-center"},O={class:"text-micro ml-2"},R={class:"text-micro text-uppercase text-grey-darken-1 mb-1"},K={key:0,class:"d-flex align-center"},j={class:"preview-mini alpha mr-2"},z={key:1,class:"text-caption text-grey italic"};function Y(e,t,a,n,s,r){const d=(0,i.g2)("v-tab"),c=(0,i.g2)("v-tabs"),h=(0,i.g2)("v-divider"),u=(0,i.g2)("v-img"),p=(0,i.g2)("v-btn"),g=(0,i.g2)("v-icon"),m=(0,i.g2)("v-tooltip"),v=(0,i.g2)("v-list-item"),y=(0,i.g2)("v-select"),f=(0,i.g2)("v-slider"),b=(0,i.g2)("v-expand-transition"),x=(0,i.g2)("v-window-item"),k=(0,i.g2)("v-window"),w=(0,i.g2)("v-card");return(0,i.uX)(),(0,i.Wv)(w,{class:"layer-widget",elevation:"10",width:"280"},{default:(0,i.k6)(()=>[(0,i.bF)(c,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),density:"compact",color:"primary",grow:""},{default:(0,i.k6)(()=>[(0,i.bF)(d,{value:"layers","slider-color":"primary"},{default:(0,i.k6)(()=>[...t[2]||(t[2]=[(0,i.eW)("Слои",-1)])]),_:1}),(0,i.bF)(d,{value:"alpha"},{default:(0,i.k6)(()=>[...t[3]||(t[3]=[(0,i.eW)("Альфа",-1)])]),_:1})]),_:1},8,["modelValue"]),(0,i.bF)(h),(0,i.Lk)("div",D,[(0,i.bF)(k,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.tab=t)},{default:(0,i.k6)(()=>[(0,i.bF)(x,{value:"layers"},{default:(0,i.k6)(()=>[0===a.layers.length?((0,i.uX)(),(0,i.CE)("div",P,"Нет слоев")):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.reversedLayers,(t,n)=>((0,i.uX)(),(0,i.CE)("div",{key:t.id,class:(0,o.C4)(["layer-row",{active:a.layers.length-1-n===a.activeIndex}]),onClick:t=>e.$emit("update-active",a.layers.length-1-n)},[(0,i.Lk)("div",B,[(0,i.bF)(p,{variant:"text",density:"comfortable",size:"small",onClick:(0,l.D$)(t=>e.$emit("toggle-visibility",a.layers.length-1-n),["stop"])},{default:(0,i.k6)(()=>[(0,i.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/158/158746.png",width:"28px"})]),_:1},8,["onClick"]),(0,i.Lk)("div",W,[(0,i.Lk)("canvas",{ref_for:!0,ref:e=>r.setPreview(e,t),width:"32",height:"32"},null,512)]),(0,i.Lk)("span",S,(0,o.v_)(t.name),1),(0,i.bF)(p,{variant:"text",color:"error",density:"comfortable",size:"small",onClick:(0,l.D$)(t=>e.$emit("remove-layer",a.layers.length-1-n),["stop"])},{default:(0,i.k6)(()=>[(0,i.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/4225/4225690.png",width:"28px"})]),_:1},8,["onClick"])]),(0,i.bF)(b,null,{default:(0,i.k6)(()=>[a.layers.length-1-n===a.activeIndex?((0,i.uX)(),(0,i.CE)("div",T,[(0,i.bF)(y,{"model-value":t.blendMode,items:e.blendModes,label:"Режим",density:"compact",variant:"outlined","hide-details":"",class:"mb-2","onUpdate:modelValue":e=>r.updateBlend(a.layers.length-1-n,e)},{item:(0,i.k6)(({props:e,item:t})=>[(0,i.bF)(v,(0,i.v6)({ref_for:!0},e),{append:(0,i.k6)(()=>[(0,i.bF)(m,{text:t.raw.desc,location:"left"},{activator:(0,i.k6)(({props:e})=>[(0,i.bF)(g,(0,i.v6)({ref_for:!0},e,{size:"x-small",class:"ml-2"}),null,16)]),_:2},1032,["text"])]),_:2},1040)]),_:1},8,["model-value","items","onUpdate:modelValue"]),(0,i.Lk)("div",E,[(0,i.bF)(g,{size:"x-small",class:"mr-2"}),(0,i.bF)(f,{"model-value":t.opacity,min:"0",max:"100",step:"1","hide-details":"",density:"compact",color:"primary","onUpdate:modelValue":e=>r.updateOpacity(a.layers.length-1-n,e)},null,8,["model-value","onUpdate:modelValue"]),(0,i.Lk)("span",O,(0,o.v_)(t.opacity)+"%",1)])])):(0,i.Q3)("",!0)]),_:2},1024)],10,X))),128))]),_:1}),(0,i.bF)(x,{value:"alpha"},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.reversedLayers,(n,s)=>((0,i.uX)(),(0,i.CE)("div",{key:"alpha-"+n.id,class:"alpha-row pa-1"},[(0,i.Lk)("div",R,(0,o.v_)(n.name),1),n.hasAlpha?((0,i.uX)(),(0,i.CE)("div",K,[(0,i.Lk)("div",j,[(0,i.Lk)("canvas",{ref_for:!0,ref:e=>r.setAlphaPreview(e,n),width:"32",height:"32"},null,512)]),t[4]||(t[4]=(0,i.Lk)("span",{class:"text-caption flex-grow-1"},"Альфа-канал",-1)),(0,i.bF)(p,{variant:"text",size:"small",color:"primary",title:"Коррекция альфа-канала",onClick:t=>e.$emit("open-alpha-curves",a.layers.length-1-s)},{default:(0,i.k6)(()=>[(0,i.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/876/876174.png",width:"22px"})]),_:1},8,["onClick"]),(0,i.bF)(p,{variant:"text",size:"small",onClick:(0,l.D$)(t=>e.$emit("toggle-alpha",a.layers.length-1-s),["stop"])},{default:(0,i.k6)(()=>[(0,i.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/3747/3747167.png",width:"22px"})]),_:1},8,["onClick"]),(0,i.bF)(p,{variant:"text",color:"error",size:"small",onClick:(0,l.D$)(t=>e.$emit("remove-alpha",a.layers.length-1-s),["stop"])},{default:(0,i.k6)(()=>[(0,i.bF)(u,{src:"https://cdn-icons-png.flaticon.com/512/484/484662.png",width:"22px"})]),_:1},8,["onClick"])])):((0,i.uX)(),(0,i.CE)("div",z,"Нет альфа-канала")),(0,i.bF)(h,{class:"my-1"})]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var H={props:["layers","activeIndex"],data:()=>({tab:"layers",blendModes:[{title:"Обычный",value:"normal",desc:"Верхний слой полностью перекрывает нижний."},{title:"Умножение",value:"multiply",desc:"Цвета перемножаются, результат всегда темнее. Полезно для теней."},{title:"Экран",value:"screen",desc:"Противоположно умножению. Результат всегда светлее."},{title:"Перекрытие",value:"overlay",desc:"Умножает или осветляет цвета в зависимости от базового слоя."}]}),computed:{reversedLayers(){return[...this.layers].reverse()}},methods:{setPreview(e,t){if(!e)return;const a=e.getContext("2d"),l=new ImageData(new Uint8ClampedArray(t.pixels),t.width,t.height),i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(l,0,0),a.clearRect(0,0,32,32),a.drawImage(i,0,0,32,32)},setAlphaPreview(e,t){if(!e)return;const a=e.getContext("2d"),l=new Uint8ClampedArray(t.pixels.length);for(let n=0;n<t.pixels.length;n+=4){const e=t.pixels[n+3];l[n]=l[n+1]=l[n+2]=e,l[n+3]=255}const i=new ImageData(l,t.width,t.height),o=document.createElement("canvas");o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(i,0,0),a.drawImage(o,0,0,32,32)},updateOpacity(e,t){this.$emit("update-opacity",{idx:e,val:t})},updateBlend(e,t){this.$emit("update-blend",{idx:e,mode:t})}}};const G=(0,x.A)(H,[["render",Y],["__scopeId","data-v-fb5dc232"]]);var Q=G;const N={class:"graph-container"},Z={viewBox:"0 0 256 256",class:"curves-svg"},q=["points"],J=["points"],ee=["points"],te=["points"],ae={class:"curve-line",stroke:"#1976D2","stroke-width":"2",fill:"none"},le=["y1","x2","y2"],ie=["x1","y1","x2","y2"],oe=["x1","y1","y2"],ne=["cx","cy"],se=["cx","cy"],re={class:"d-flex gap-2 mb-4"},de={class:"d-flex gap-2 mb-4"};function ce(e,t,a,l,o,n){const s=(0,i.g2)("v-btn"),r=(0,i.g2)("v-card-title"),d=(0,i.g2)("v-col"),c=(0,i.g2)("v-text-field"),h=(0,i.g2)("v-checkbox"),u=(0,i.g2)("v-row"),p=(0,i.g2)("v-card-text"),g=(0,i.g2)("v-divider"),m=(0,i.g2)("v-spacer"),v=(0,i.g2)("v-card-actions"),y=(0,i.g2)("v-card"),f=(0,i.g2)("v-dialog");return(0,i.uX)(),(0,i.Wv)(f,{"model-value":a.modelValue,"onUpdate:modelValue":t[5]||(t[5]=t=>e.$emit("update:modelValue",t)),"max-width":"600px",persistent:""},{default:(0,i.k6)(()=>[(0,i.bF)(y,null,{default:(0,i.k6)(()=>[(0,i.bF)(r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)(()=>[t[6]||(t[6]=(0,i.eW)(" Градационная коррекция (Кривые) ",-1)),(0,i.bF)(s,{icon:"mdi-close",variant:"text",onClick:n.close},null,8,["onClick"])]),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,{cols:"12",md:"7"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",N,[((0,i.uX)(),(0,i.CE)("svg",Z,[t[7]||(t[7]=(0,i.Lk)("line",{x1:"64",y1:"0",x2:"64",y2:"256",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),t[8]||(t[8]=(0,i.Lk)("line",{x1:"128",y1:"0",x2:"128",y2:"256",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),t[9]||(t[9]=(0,i.Lk)("line",{x1:"192",y1:"0",x2:"192",y2:"256",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),t[10]||(t[10]=(0,i.Lk)("line",{x1:"0",y1:"64",x2:"256",y2:"64",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),t[11]||(t[11]=(0,i.Lk)("line",{x1:"0",y1:"128",x2:"256",y2:"128",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),t[12]||(t[12]=(0,i.Lk)("line",{x1:"0",y1:"192",x2:"256",y2:"192",stroke:"#ddd","stroke-dasharray":"4"},null,-1)),a.isAlphaMode?((0,i.uX)(),(0,i.CE)("polyline",{key:1,points:n.getHistogramPoints("a"),fill:"none",stroke:"rgba(128,128,128,0.8)","stroke-width":"1"},null,8,te)):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("polyline",{points:n.getHistogramPoints("r"),fill:"none",stroke:"rgba(255,0,0,0.5)","stroke-width":"1"},null,8,q),(0,i.Lk)("polyline",{points:n.getHistogramPoints("g"),fill:"none",stroke:"rgba(0,255,0,0.5)","stroke-width":"1"},null,8,J),(0,i.Lk)("polyline",{points:n.getHistogramPoints("b"),fill:"none",stroke:"rgba(0,0,255,0.5)","stroke-width":"1"},null,8,ee)],64)),(0,i.Lk)("g",ae,[(0,i.Lk)("line",{x1:0,y1:256-o.p1.y,x2:o.p1.x,y2:256-o.p1.y},null,8,le),(0,i.Lk)("line",{x1:o.p1.x,y1:256-o.p1.y,x2:o.p2.x,y2:256-o.p2.y},null,8,ie),(0,i.Lk)("line",{x1:o.p2.x,y1:256-o.p2.y,x2:256,y2:256-o.p2.y},null,8,oe)]),(0,i.Lk)("circle",{cx:o.p1.x,cy:256-o.p1.y,r:"4",fill:"#1976D2"},null,8,ne),(0,i.Lk)("circle",{cx:o.p2.x,cy:256-o.p2.y,r:"4",fill:"#1976D2"},null,8,se)]))])]),_:1}),(0,i.bF)(d,{cols:"12",md:"5"},{default:(0,i.k6)(()=>[t[13]||(t[13]=(0,i.Lk)("div",{class:"text-subtitle-2 mb-2"},"Точка 1 (Вход; Выход)",-1)),(0,i.Lk)("div",re,[(0,i.bF)(c,{modelValue:o.p1.x,"onUpdate:modelValue":t[0]||(t[0]=e=>o.p1.x=e),modelModifiers:{number:!0},label:"In 1",type:"number",density:"compact","hide-details":"",min:"0",max:"255"},null,8,["modelValue"]),(0,i.bF)(c,{modelValue:o.p1.y,"onUpdate:modelValue":t[1]||(t[1]=e=>o.p1.y=e),modelModifiers:{number:!0},label:"Out 1",type:"number",density:"compact","hide-details":"",min:"0",max:"255"},null,8,["modelValue"])]),t[14]||(t[14]=(0,i.Lk)("div",{class:"text-subtitle-2 mb-2"},"Точка 2 (Вход; Выход)",-1)),(0,i.Lk)("div",de,[(0,i.bF)(c,{modelValue:o.p2.x,"onUpdate:modelValue":t[2]||(t[2]=e=>o.p2.x=e),modelModifiers:{number:!0},label:"In 2",type:"number",density:"compact","hide-details":"",min:"0",max:"255"},null,8,["modelValue"]),(0,i.bF)(c,{modelValue:o.p2.y,"onUpdate:modelValue":t[3]||(t[3]=e=>o.p2.y=e),modelModifiers:{number:!0},label:"Out 2",type:"number",density:"compact","hide-details":"",min:"0",max:"255"},null,8,["modelValue"])]),(0,i.bF)(h,{modelValue:o.preview,"onUpdate:modelValue":t[4]||(t[4]=e=>o.preview=e),label:"Предпросмотр",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,i.bF)(g),(0,i.bF)(v,null,{default:(0,i.k6)(()=>[(0,i.bF)(s,{color:"grey",variant:"text",onClick:n.reset},{default:(0,i.k6)(()=>[...t[15]||(t[15]=[(0,i.eW)("Сбросить",-1)])]),_:1},8,["onClick"]),(0,i.bF)(m),(0,i.bF)(s,{color:"primary",onClick:n.apply},{default:(0,i.k6)(()=>[...t[16]||(t[16]=[(0,i.eW)("Применить",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}var he={props:{modelValue:Boolean,layer:Object,isAlphaMode:Boolean},data(){return{p1:{x:0,y:0},p2:{x:255,y:255},preview:!1,histograms:{r:[],g:[],b:[],a:[]}}},watch:{modelValue(e){e&&(this.calculateHistogram(),this.reset())},lut:{handler(e){this.preview&&this.$emit("preview",e)},deep:!0},preview(e){e?this.$emit("preview",this.lut):this.$emit("preview",null)}},computed:{lut(){const e=new Uint8ClampedArray(256),{x:t,y:a}=this.p1,{x:l,y:i}=this.p2;for(let o=0;o<256;o++)e[o]=o<=t?a:o>=l?i:a+(o-t)*(i-a)/(l-t);return e}},methods:{calculateHistogram(){if(!this.layer)return;const e=new Array(256).fill(0),t=new Array(256).fill(0),a=new Array(256).fill(0),l=new Array(256).fill(0),i=this.layer.pixels;for(let o=0;o<i.length;o+=4)e[i[o]]++,t[i[o+1]]++,a[i[o+2]]++,l[i[o+3]]++;this.histograms={r:e,g:t,b:a,a:l}},getHistogramPoints(e){const t=this.histograms[e];if(!t.length)return"";const a=Math.max(...t);return t.map((e,t)=>`${t},${256-e/a*256}`).join(" ")},reset(){this.p1={x:0,y:0},this.p2={x:255,y:255}},close(){this.$emit("preview",null),this.$emit("update:modelValue",!1)},apply(){this.$emit("confirm",{lut:this.lut,isAlpha:this.isAlphaMode}),this.close()}}};const ue=(0,x.A)(he,[["render",ce],["__scopeId","data-v-f4231c32"]]);var pe=ue;const ge={class:"kernel-grid my-4"};function me(e,t,a,l,o,n){const s=(0,i.g2)("v-btn"),r=(0,i.g2)("v-card-title"),d=(0,i.g2)("v-select"),c=(0,i.g2)("v-text-field"),h=(0,i.g2)("v-checkbox"),u=(0,i.g2)("v-card-text"),p=(0,i.g2)("v-spacer"),g=(0,i.g2)("v-card-actions"),m=(0,i.g2)("v-card"),v=(0,i.g2)("v-dialog");return(0,i.uX)(),(0,i.Wv)(v,{modelValue:e.visible,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.visible=t),t[3]||(t[3]=t=>e.$emit("update:modelValue",t))],"model-value":a.modelValue,"max-width":"500px",persistent:""},{default:(0,i.k6)(()=>[(0,i.bF)(m,{color:"#1e1e1e",class:"text-white"},{default:(0,i.k6)(()=>[(0,i.bF)(r,{class:"d-flex justify-space-between align-center"},{default:(0,i.k6)(()=>[t[4]||(t[4]=(0,i.Lk)("span",null,"Матричный фильтр",-1)),(0,i.bF)(s,{icon:"mdi-close",variant:"text",onClick:n.close},null,8,["onClick"])]),_:1}),(0,i.bF)(u,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,{modelValue:e.selectedPreset,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.selectedPreset=t),n.applyPreset],items:e.presetOptions,label:"Преднастроенные значения",variant:"outlined"},null,8,["modelValue","items","onUpdate:modelValue"]),(0,i.Lk)("div",ge,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.kernel,(t,a)=>((0,i.uX)(),(0,i.Wv)(c,{key:a,modelValue:e.kernel[a],"onUpdate:modelValue":t=>e.kernel[a]=t,modelModifiers:{number:!0},type:"number",variant:"solo",density:"compact","hide-details":"",class:"kernel-input",onInput:n.onInput},null,8,["modelValue","onUpdate:modelValue","onInput"]))),128))]),(0,i.bF)(h,{modelValue:e.preview,"onUpdate:modelValue":t[1]||(t[1]=t=>e.preview=t),label:"Предварительный просмотр","hide-details":"",onChange:n.onInput},null,8,["modelValue","onChange"])]),_:1}),(0,i.bF)(g,null,{default:(0,i.k6)(()=>[(0,i.bF)(s,{color:"error",variant:"text",onClick:n.reset},{default:(0,i.k6)(()=>[...t[5]||(t[5]=[(0,i.eW)("Сбросить",-1)])]),_:1},8,["onClick"]),(0,i.bF)(p),(0,i.bF)(s,{variant:"text",onClick:n.close},{default:(0,i.k6)(()=>[...t[6]||(t[6]=[(0,i.eW)("Отмена",-1)])]),_:1},8,["onClick"]),(0,i.bF)(s,{color:"primary",variant:"elevated",onClick:n.apply},{default:(0,i.k6)(()=>[...t[7]||(t[7]=[(0,i.eW)("Применить",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","model-value"])}var ve={data:()=>({visible:!1,preview:!1,selectedPreset:"Тождественное",kernel:[0,0,0,0,1,0,0,0,0],originalPixels:null,presetOptions:["Тождественное","Резкость","Гаусс (3x3)","Прямоугольное размытие","Прюитт X","Прюитт Y"],presets:{"Тождественное":[0,0,0,0,1,0,0,0,0],"Резкость":[0,-1,0,-1,5,-1,0,-1,0],"Гаусс (3x3)":[.06,.15,.06,.15,.25,.15,.06,.15,.06],"Прямоугольное размытие":Array(9).fill(1/9),"Прюитт X":[-1,0,1,-1,0,1,-1,0,1],"Прюитт Y":[-1,-1,-1,0,0,0,1,1,1]}}),props:{modelValue:Boolean,activeLayer:Object},emits:["update:modelValue","apply","preview","restore"],methods:{open(e){this.originalPixels=new Uint8ClampedArray(e),this.visible=!0,this.reset()},applyPreset(){this.kernel=[...this.presets[this.selectedPreset]],this.onInput()},onInput(){this.preview?this.$emit("preview",this.kernel):this.$emit("restore")},reset(){this.selectedPreset="Тождественное",this.kernel=[...this.presets["Тождественное"]],this.onInput()},close(){this.$emit("restore"),this.$emit("update:modelValue",!1)},apply(){this.$emit("apply",[...this.kernel]),this.$emit("update:modelValue",!1)}}};const ye=(0,x.A)(ve,[["render",me],["__scopeId","data-v-0267d0de"]]);var fe=ye,be={name:"App",components:{MenuComponent:w,CanvasComponent:_,ResizeComponent:$,LayersComponent:Q,CurvesDialog:pe,KernelDialog:fe},props:["layersCount"],data(){return{imageSrc:null,scalePercent:100,showResize:!1,activeTool:"hand",colorA:null,colorB:null,spaceInfo:{RGB:{title:"RGB",axes:"Red, Green, Blue: 0-255."},XYZ:{title:"XYZ",axes:"X: ~0-95, Y (Яркость): 0-100, Z: ~0-108."},Lab:{title:"Lab",axes:"L (Светлота): 0-100, a: (Зел/Крас), b: (Син/Желт)."},OKLch:{title:"OKLch",axes:"L: 0-1, C (Насыщенность): 0-0.4, h (Тон): 0-360°."}},layers:[],activeLayerIndex:0,showCurves:!1,curvesAlphaMode:!1,tempLut:null,showKernel:!1,kernelAlphaMode:!1}},computed:{contrastValue(){return this.colorA&&this.colorB?this.calculateContrast(this.colorA,this.colorB).toFixed(2):"0"},statusText(){if(0===this.layers.length)return"Загрузите изображение";const e=this.layers[this.activeLayerIndex];return`Слой: ${e?.name}   |   Размер: ${e?.width}x${e?.height} px   |   Глубина: ${e?.depth} бит`}},mounted(){window.addEventListener("keydown",this.handleGlobalKeyDown)},beforeUnmount(){window.removeEventListener("keydown",this.handleGlobalKeyDown)},methods:{onLayerAdded(e){if(this.layers.length>=2)return;const t={id:Date.now(),name:0===this.layers.length?"Слой 1":"Слой 2",pixels:e.pixels||this.extractPixels(e.src,e.width,e.height),width:e.width,height:e.height,depth:e.depth,opacity:100,visible:!0,blendMode:"normal",alphaVisible:!0,hasAlpha:!0,preview:""};this.layers.push(t),this.activeLayerIndex=this.layers.length-1},onColorLayerAdded(e){if(0===this.layers.length)return;const t=this.layers[0],a=t.width*t.height*4,l=new Uint8ClampedArray(a);for(let i=0;i<a;i+=4)l[i]=e.r,l[i+1]=e.g,l[i+2]=e.b,l[i+3]=255;this.onLayerAdded({pixels:l,width:t.width,height:t.height})},extractPixels(e,t,a){const l=document.createElement("canvas");l.width=t,l.height=a;const i=l.getContext("2d"),o=new Image;return o.src=e,i.drawImage(o,0,0),i.getImageData(0,0,t,a).data},toggleVisibility(e){this.layers[e].visible=!this.layers[e].visible},toggleAlpha(e){this.layers[e].alphaVisible=!this.layers[e].alphaVisible},removeLayer(e){this.layers.splice(e,1),this.activeLayerIndex=Math.max(0,this.layers.length-1)},removeAlpha(e){const t=this.layers[e];for(let a=3;a<t.pixels.length;a+=4)t.pixels[a]=255;t.hasAlpha=!1},updateOpacity({idx:e,val:t}){this.layers[e].opacity=t},updateBlend({idx:e,mode:t}){this.layers[e].blendMode=t},handleGlobalKeyDown(e){const t=e.key.toLowerCase();"h"===t&&(this.activeTool="hand"),"i"===t&&(this.activeTool="eyedropper")},onImageLoaded(e){this.imageSrc=e},onScaleChanged(e){this.scalePercent=e},applyResize(e){0!==this.layers.length&&(this.layers=this.layers.map(t=>{const a=this.$refs.canvas.runResizeAlgo(t.pixels,t.width,t.height,e.width,e.height,e.interpolation);return{...t,pixels:a,width:e.width,height:e.height}}),this.$nextTick(()=>{this.$refs.canvas.fitToScreen()}))},onPickColor({color:e,slot:t}){"A"===t?this.colorA=e:this.colorB=e},calculateContrast(e,t){if(!e||!t)return 0;const a=e=>{let t=e.r/255,a=e.g/255,l=e.b/255;return t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),a=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),l=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4),.2126*t+.7152*a+.0722*l},l=a(e),i=a(t);return(Math.max(l,i)+.05)/(Math.min(l,i)+.05)},rgbString(e){return`rgb(${e.r}, ${e.g}, ${e.b})`},getSpaceValues(e,t){const{r:a,g:l,b:i}=t;let o=a/255,n=l/255,s=i/255;const r=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),d=r(o),c=r(n),h=r(s);if("RGB"===e)return`${a},${l},${i}`;const u=100*(.4124*d+.3576*c+.1805*h),p=100*(.2126*d+.7152*c+.0722*h),g=100*(.0193*d+.1192*c+.9505*h);if("XYZ"===e)return`${u.toFixed(0)},${p.toFixed(0)},${g.toFixed(0)}`;const m=e=>e>.008856?Math.pow(e,1/3):7.787*e+16/116,v=116*m(p/100)-16,y=500*(m(u/95.047)-m(p/100)),f=200*(m(p/100)-m(g/108.883));if("Lab"===e)return`${v.toFixed(0)},${y.toFixed(0)},${f.toFixed(0)}`;const b=Math.sqrt(y*y+f*f);let x=Math.atan2(f,y)*(180/Math.PI);return x<0&&(x+=360),"OKLch"===e?`${(v/100).toFixed(2)},${(b/100).toFixed(2)},${x.toFixed(0)}°`:""},applyCurves({lut:e,isAlpha:t}){const a=this.layers[this.activeLayerIndex];if(!a||!a.pixels)return void console.warn("Попытка применить коррекцию к несуществующему слою");const l=new Uint8ClampedArray(a.pixels);for(let i=0;i<l.length;i+=4)t?l[i+3]=e[l[i+3]]:(l[i]=e[l[i]],l[i+1]=e[l[i+1]],l[i+2]=e[l[i+2]]);a.pixels=l,this.tempLut=null,this.layers=[...this.layers]},handleCurvesPreview(e){this.layers.length>0&&this.layers[this.activeLayerIndex]?this.tempLut=e:this.tempLut=null},openCurves(e=!1){0!==this.layers.length&&(this.curvesAlphaMode=e,this.showCurves=!0)},async handleExport(e){if(!this.layers||0===this.layers.length)return;const t=this.layers[0].width,a=this.layers[0].height,l=document.createElement("canvas");l.width=t,l.height=a;const i=l.getContext("2d");i.clearRect(0,0,t,a);const o=[...this.layers];if(o.forEach(e=>{if(!1===e.visible)return;const l=document.createElement("canvas");l.width=e.width,l.height=e.height;const o=l.getContext("2d"),n=new ImageData(new Uint8ClampedArray(e.pixels),e.width,e.height);o.putImageData(n,0,0),i.save(),void 0!==e.opacity?i.globalAlpha=e.opacity/100:i.globalAlpha=1,i.globalCompositeOperation=e.blendMode||"source-over";const s=e.x||0,r=e.y||0,d=e.displayWidth||t,c=e.displayHeight||a;i.drawImage(l,s,r,d,c),i.restore()}),"gb7"===e){const e=i.getImageData(0,0,t,a).data;this.saveGB7(e,t,a)}else this.saveStandard(l,e)},saveGB7(e,t,a){const l=new ArrayBuffer(12),i=new DataView(l);i.setUint8(0,71),i.setUint8(1,66),i.setUint8(2,55),i.setUint8(3,29),i.setUint8(4,1),i.setUint8(5,1),i.setUint16(6,t,!1),i.setUint16(8,a,!1),i.setUint16(10,0,!1);const o=new Uint8Array(t*a);for(let s=0;s<t*a;s++){const t=e[4*s],a=e[4*s+1],l=e[4*s+2],i=e[4*s+3],n=Math.round(.299*t+.587*a+.114*l),r=Math.floor(n/2),d=i>128?128:0;o[s]=d|127&r}const n=new Blob([l,o],{type:"application/octet-stream"});this.download(n,`export_${Date.now()}.gb7`)},saveStandard(e,t){const a="jpg"===t?"image/jpeg":"image/png";e.toBlob(e=>{this.download(e,`export_${Date.now()}.${t}`)},a,.95)},download(e,t){const a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=t,l.click(),URL.revokeObjectURL(a)},applyConvolution(e){if(-1===this.activeLayerIndex||!this.layers[this.activeLayerIndex])return;if(!e||e.length<9)return;const t=this.layers[this.activeLayerIndex],a=t.pixels,l=t.width,i=t.height,o=new Uint8ClampedArray(a.length),n=(e,t,o)=>{const n=Math.min(l-1,Math.max(0,e)),s=Math.min(i-1,Math.max(0,t));return a[4*(s*l+n)+o]};for(let s=0;s<i;s++)for(let t=0;t<l;t++){let i=0,r=0,d=0;for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++){const o=e[3*(a+1)+(l+1)];i+=n(t+l,s+a,0)*o,r+=n(t+l,s+a,1)*o,d+=n(t+l,s+a,2)*o}const c=4*(s*l+t);o[c]=Math.min(255,Math.max(0,i)),o[c+1]=Math.min(255,Math.max(0,r)),o[c+2]=Math.min(255,Math.max(0,d)),o[c+3]=a[c+3]}return o},onKernelPreview(e){const t=this.layers[this.activeLayerIndex];this.tempBackup||(this.tempBackup=new Uint8ClampedArray(t.pixels)),t.pixels=this.applyConvolution(e,this.activeLayerIndex)},onKernelRestore(){this.tempBackup&&(this.layers[this.activeLayerIndex].pixels=new Uint8ClampedArray(this.tempBackup),this.tempBackup=null)},onKernelApply(e){this.tempBackup=null,this.layers[this.activeLayerIndex].pixels=this.applyConvolution(e,this.activeLayerIndex)}}};const xe=(0,x.A)(be,[["render",y],["__scopeId","data-v-4d4414fc"]]);var ke=xe,we=(a(5524),a(5753)),Ce=a(1839),Le=a(3425),Fe=a(465);const Ve=(0,we.$N)({components:Ce,directives:Le,icons:{defaultSet:"mdi",aliases:Fe.z,sets:{mdi:Fe.r}}});(0,l.Ef)(ke).use(Ve).mount("#app")}},t={};function a(l){var i=t[l];if(void 0!==i)return i.exports;var o=t[l]={exports:{}};return e[l].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,l,i,o){if(!l){var n=1/0;for(c=0;c<e.length;c++){l=e[c][0],i=e[c][1],o=e[c][2];for(var s=!0,r=0;r<l.length;r++)(!1&o||n>=o)&&Object.keys(a.O).every(function(e){return a.O[e](l[r])})?l.splice(r--,1):(s=!1,o<n&&(n=o));if(s){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[l,i,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,l){var i,o,n=l[0],s=l[1],r=l[2],d=0;if(n.some(function(t){return 0!==e[t]})){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(r)var c=r(a)}for(t&&t(l);d<n.length;d++)o=n[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},l=self["webpackChunkphotoshop"]=self["webpackChunkphotoshop"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],function(){return a(4152)});l=a.O(l)})();
//# sourceMappingURL=app.089099be.js.map